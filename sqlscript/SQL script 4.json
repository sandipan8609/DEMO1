{
	"name": "SQL script 4",
	"properties": {
		"content": {
			"query": "CREATE EXTERNAL DATA SOURCE AzureStorage_west_public\nWITH\n(  \n    TYPE = Hadoop\n,   LOCATION = 'wasbs://contosoretaildw-tables@contosoretaildw.blob.core.windows.net/'\n);\n\nCREATE EXTERNAL FILE FORMAT TextFileFormat\nWITH\n(   FORMAT_TYPE = DELIMITEDTEXT\n,    FORMAT_OPTIONS    (   FIELD_TERMINATOR = '|'\n                    ,    STRING_DELIMITER = ''\n                    ,    DATE_FORMAT         = 'yyyy-MM-dd HH:mm:ss.fff'\n                    ,    USE_TYPE_DEFAULT = FALSE\n                    )\n);\n\nCREATE SCHEMA [asb]\nGO\n\n--DimProduct\nCREATE EXTERNAL TABLE [asb].DimProduct (\n    [ProductKey] [int] NOT NULL,\n    [ProductLabel] [nvarchar](255) NULL,\n    [ProductName] [nvarchar](500) NULL,\n    [ProductDescription] [nvarchar](400) NULL,\n    [ProductSubcategoryKey] [int] NULL,\n    [Manufacturer] [nvarchar](50) NULL,\n    [BrandName] [nvarchar](50) NULL,\n    [ClassID] [nvarchar](10) NULL,\n    [ClassName] [nvarchar](20) NULL,\n    [StyleID] [nvarchar](10) NULL,\n    [StyleName] [nvarchar](20) NULL,\n    [ColorID] [nvarchar](10) NULL,\n    [ColorName] [nvarchar](20) NOT NULL,\n    [Size] [nvarchar](50) NULL,\n    [SizeRange] [nvarchar](50) NULL,\n    [SizeUnitMeasureID] [nvarchar](20) NULL,\n    [Weight] [float] NULL,\n    [WeightUnitMeasureID] [nvarchar](20) NULL,\n    [UnitOfMeasureID] [nvarchar](10) NULL,\n    [UnitOfMeasureName] [nvarchar](40) NULL,\n    [StockTypeID] [nvarchar](10) NULL,\n    [StockTypeName] [nvarchar](40) NULL,\n    [UnitCost] [money] NULL,\n    [UnitPrice] [money] NULL,\n    [AvailableForSaleDate] [datetime] NULL,\n    [StopSaleDate] [datetime] NULL,\n    [Status] [nvarchar](7) NULL,\n    [ImageURL] [nvarchar](150) NULL,\n    [ProductURL] [nvarchar](150) NULL,\n    [ETLLoadID] [int] NULL,\n    [LoadDate] [datetime] NULL,\n    [UpdateDate] [datetime] NULL\n)\nWITH\n(\n    LOCATION='/DimProduct/'\n,   DATA_SOURCE = AzureStorage_west_public\n,   FILE_FORMAT = TextFileFormat\n,   REJECT_TYPE = VALUE\n,   REJECT_VALUE = 0\n)\n;\n\n--FactOnlineSales\nCREATE EXTERNAL TABLE [asb].FactOnlineSales\n(\n    [OnlineSalesKey] [int]  NOT NULL,\n    [DateKey] [datetime] NOT NULL,\n    [StoreKey] [int] NOT NULL,\n    [ProductKey] [int] NOT NULL,\n    [PromotionKey] [int] NOT NULL,\n    [CurrencyKey] [int] NOT NULL,\n    [CustomerKey] [int] NOT NULL,\n    [SalesOrderNumber] [nvarchar](20) NOT NULL,\n    [SalesOrderLineNumber] [int] NULL,\n    [SalesQuantity] [int] NOT NULL,\n    [SalesAmount] [money] NOT NULL,\n    [ReturnQuantity] [int] NOT NULL,\n    [ReturnAmount] [money] NULL,\n    [DiscountQuantity] [int] NULL,\n    [DiscountAmount] [money] NULL,\n    [TotalCost] [money] NOT NULL,\n    [UnitCost] [money] NULL,\n    [UnitPrice] [money] NULL,\n    [ETLLoadID] [int] NULL,\n    [LoadDate] [datetime] NULL,\n    [UpdateDate] [datetime] NULL\n)\nWITH\n(\n    LOCATION='/FactOnlineSales/'\n,   DATA_SOURCE = AzureStorage_west_public\n,   FILE_FORMAT = TextFileFormat\n,   REJECT_TYPE = VALUE\n,   REJECT_VALUE = 0\n)\n;\n\n\nCREATE SCHEMA [cso]\nGO\n\n\nSELECT  SUM(f.[SalesAmount]) AS [sales_by_brand_amount]\n,       p.[BrandName]\nFROM    [cso].[FactOnlineSales] AS f\nJOIN    [cso].[DimProduct]      AS p ON f.[ProductKey] = p.[ProductKey]\nGROUP BY p.[BrandName]\n\nSELECT GETDATE();\nGO\n\nCREATE TABLE [cso].[DimProduct]            WITH (DISTRIBUTION = HASH([ProductKey]  ) ) AS SELECT * FROM [asb].[DimProduct]             OPTION (LABEL = 'CTAS : Load [cso].[DimProduct]             ');\nCREATE TABLE [cso].[FactOnlineSales]       WITH (DISTRIBUTION = HASH([ProductKey]  ) ) AS SELECT * FROM [asb].[FactOnlineSales]        OPTION (LABEL = 'CTAS : Load [cso].[FactOnlineSales]        ');",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "SQLPool01",
				"poolName": "SQLPool01"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}